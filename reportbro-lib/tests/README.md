# reportbro-lib tests

reportbro-lib uses pytest as test runner. Run with the following command in the root directory:

```
poetry run pytest
```
or to run a specific test use the `-k` parameter like:
```
poetry run pytest -k test_report_demo_render[invoice]
```

## Demo tests
Test for demo files are defined in `tests/test_report_render.py. All demo tests added to the `DEMOS` list are run.

Each demo has a directory in `tests/data/demos/` with the following content:

* a json file called like the demo (e.g. `invoice.json`) containing the report definition
* report.pdf or report.pdf.checksum
* report.xlsx or report.xlsx.checksum
* data.json (optional)

If no `data.json` is found the test parameters from the report definition are used (if any).
The checksum files can be used to omit the generated report in case of large reports.

### Regenerate test data

In case the report definition or the data of a test changes it can be regenerated by running:

```
poetry run scripts/regenerate_test_report_output.py [-g GROUP_NAME] [-r REPORT_NAME] [-k]
```

This re-generates pdf and xlsx output for available tests. If no *GROUP_NAME* is specified then all
tests are processed, otherwise only tests of available groups *demos*, *guides* or *misc* are considered.
If *GROUP_NAME* and *REPORT_NAME* are specified then only the output for this single test is re-generated.
If option *k* (or *keep*) is specified then the report output will be written to a another file (in case the
output is different) and the original report output will not be overwritten.
